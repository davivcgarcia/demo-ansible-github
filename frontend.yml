#
# Autor: Davi Garcia <dvercill@redhat.com>
# Data: 14-07-2020
#
# Playbook para configurar e implantar o servi√ßo de frontend
#

- name: Deploy application frontend service
  hosts: frontend
  become: yes
  tasks:
  - name: Installing frontend dependencies (packages)
    package:
      name:
      - nginx
      state: present
  - name: Copy frontend artifacts to deployment directory
    copy:
      src: app-src/public/
      dest: /srv/frontend
  - name: Nginx service must be started on boot
    service:
      name: nginx
      enabled: yes
      state: started
  - name: Configure root HTML dir for Nginx
    lineinfile:
      path: /etc/nginx/nginx.conf
      regexp: '^        root         /usr/share/nginx/html;'
      line: '        root         /srv/frontend;'
    notify:
    - Restart Nginx service
  handlers:
  - name: Restart Nginx service
    service:
      name: nginx
      state: restarted